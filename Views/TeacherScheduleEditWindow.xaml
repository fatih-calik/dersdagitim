<Window x:Class="DersDagitim.Views.TeacherScheduleEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Programda Değişiklik"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="White" CornerRadius="20" Margin="10"
            BorderBrush="#E2E8F0" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="30" ShadowDepth="5" Opacity="0.10" Direction="270"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="*"/>     <!-- Content -->
                <RowDefinition Height="Auto"/>  <!-- Status Bar -->
            </Grid.RowDefinitions>

            <!-- ===== HEADER ===== -->
            <Border Grid.Row="0" Background="#F8FAFC" CornerRadius="20,20,0,0" Padding="14,7"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <DockPanel>
                    <Button DockPanel.Dock="Right" Content="✕" Click="BtnClose_Click"
                            Background="Transparent" Foreground="#94A3B8" FontSize="16"
                            Padding="6,1" Cursor="Hand" BorderThickness="0"
                            VerticalAlignment="Center"/>

                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Margin="0,0,8,0">
                        <Button x:Name="BtnUndo" Content="Geri Al" Click="BtnUndo_Click"
                                Style="{StaticResource ModernButton}"
                                Padding="16,6" Foreground="White" Background="#EF4444"
                                IsEnabled="False" Margin="0,0,6,0"/>
                        <Button x:Name="BtnApply" Content="Onayla" Click="BtnApply_Click"
                                Style="{StaticResource ModernButton}"
                                Padding="16,6" Foreground="White" IsEnabled="False">
                            <Button.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#10B981" Offset="0"/>
                                    <GradientStop Color="#059669" Offset="1"/>
                                </LinearGradientBrush>
                            </Button.Background>
                        </Button>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Width="30" Height="30" CornerRadius="8" Margin="0,0,8,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#2563EB" Offset="0"/>
                                    <GradientStop Color="#7C3AED" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="✎" Foreground="White" FontSize="16"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="Programda Değişiklik" FontSize="15" FontWeight="Bold"
                                   Foreground="#1E293B" VerticalAlignment="Center"/>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- ===== CONTENT ===== -->
            <Grid Grid.Row="1" Margin="8,4,8,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="400"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*" MinWidth="400"/>
                </Grid.ColumnDefinitions>

                <!-- ===== SOL SÜTUN: Değişiklik Yap ===== -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>   <!-- Combo -->
                        <RowDefinition Height="4*"/>     <!-- Grid -->
                        <RowDefinition Height="Auto"/>   <!-- Başlık -->
                        <RowDefinition Height="1*" MinHeight="80"/>  <!-- Değişen öğretmenler -->
                    </Grid.RowDefinitions>

                    <!-- Öğretmen Seçimi -->
                    <Border Grid.Row="0" Margin="4,0,4,4">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Öğretmen:" VerticalAlignment="Center"
                                       Foreground="#64748B" FontSize="12" Margin="0,0,6,0"/>
                            <ComboBox x:Name="TeacherCombo" Width="260" FontSize="12"
                                      SelectionChanged="TeacherCombo_SelectionChanged"
                                      DisplayMemberPath="Name" SelectedValuePath="Id"/>
                        </StackPanel>
                    </Border>

                    <!-- Öğretmen Program Grid'i -->
                    <Border Grid.Row="1" Background="White" CornerRadius="8"
                            BorderBrush="#E2E8F0" BorderThickness="1" Margin="4,0">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel x:Name="ScheduleGridPanel" Margin="3"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Değişen Öğretmenler Başlığı -->
                    <Border Grid.Row="2" Padding="6,4,6,2" Margin="4,4,4,0">
                        <TextBlock x:Name="ChangedTeachersHeader" Text="Değişen Öğretmenler"
                                   FontWeight="Bold" FontSize="12" Foreground="#1E293B"/>
                    </Border>

                    <!-- Değişen Öğretmenler Listesi -->
                    <Border Grid.Row="3" Background="#F8FAFC" CornerRadius="8"
                            BorderBrush="#E2E8F0" BorderThickness="1" Margin="4,0,4,2">
                        <ListBox x:Name="ChangedTeachersList" FontSize="11"
                                 SelectionChanged="ChangedTeachersList_SelectionChanged"
                                 Background="Transparent" BorderThickness="0"
                                 DisplayMemberPath="Name"/>
                    </Border>
                </Grid>

                <!-- Ayırıcı -->
                <Border Grid.Column="1" Width="1" Background="#E2E8F0" Margin="2,0"/>

                <!-- ===== SAĞ SÜTUN: Eski/Yeni Durum ===== -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Eski Durum Başlığı -->
                    <Border Grid.Row="0" Padding="6,2" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <Border Width="10" Height="10" CornerRadius="3" Background="#EF4444" Margin="0,0,5,0"/>
                            <TextBlock x:Name="OldStateTitle" Text="Eski Durum"
                                       FontWeight="Bold" FontSize="12" Foreground="#EF4444"/>
                        </StackPanel>
                    </Border>

                    <!-- Eski Durum Grid -->
                    <Border Grid.Row="1" Background="#FFF5F5" CornerRadius="8"
                            BorderBrush="#FCA5A5" BorderThickness="1" Margin="4,0">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel x:Name="OldStateGridPanel" Margin="3"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Yeni Durum Başlığı -->
                    <Border Grid.Row="2" Padding="6,4,6,2" Margin="4,0">
                        <StackPanel Orientation="Horizontal">
                            <Border Width="10" Height="10" CornerRadius="3" Background="#10B981" Margin="0,0,5,0"/>
                            <TextBlock x:Name="NewStateTitle" Text="Yeni Durum"
                                       FontWeight="Bold" FontSize="12" Foreground="#10B981"/>
                        </StackPanel>
                    </Border>

                    <!-- Yeni Durum Grid -->
                    <Border Grid.Row="3" Background="#F0FDF4" CornerRadius="8"
                            BorderBrush="#86EFAC" BorderThickness="1" Margin="4,0,4,2">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel x:Name="NewStateGridPanel" Margin="3"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Grid>

            <!-- ===== STATUS BAR ===== -->
            <Border Grid.Row="2" Padding="12,6" Background="#F8FAFC"
                    CornerRadius="0,0,20,20">
                <DockPanel>
                    <TextBlock x:Name="StatusText" Text="Öğretmen seçin"
                               Foreground="#64748B" FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock x:Name="SelectedBlockInfo" Text=""
                               Foreground="#2563EB" FontWeight="SemiBold" FontSize="12"
                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                </DockPanel>
            </Border>

            <!-- ===== LOADING OVERLAY ===== -->
            <Border x:Name="LoadingOverlay" Grid.RowSpan="3"
                    Background="#80FFFFFF" Visibility="Collapsed" CornerRadius="20">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#2563EB" Margin="0,0,0,12"/>
                    <TextBlock Text="Değişiklik uygulanmaya çalışılıyor..." FontSize="14" FontWeight="SemiBold"
                               Foreground="#1E293B" HorizontalAlignment="Center"/>
                    <TextBlock Text="Tüm çakışmalar matematiksel olarak çözülüyor" FontSize="11"
                               Foreground="#64748B" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>
